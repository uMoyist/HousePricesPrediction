## House Prices - Advanced Regression Techniques



TensorFlow Decision Forests要求python3.9及以上版本

conda可以直接使用命令 conda install python=3.9更新版本，会自动处理兼容问题

- 查看数据的基本信息：
  - 使用`df.info()`查看数据的列名、非空值数量和数据类型等信息。这有助于发现数据中是否存在缺失值以及各列的数据类型是否符合预期。
  - 使用`df.describe()`可以获取数值列的基本统计信息，如均值、标准差、最小值、最大值和分位数等。

```python
dataset = pd.read_csv(datapath)

buffer = StringIO()

dataset.info(buf=buffer)

info_str = buffer.getvalue()
with open("../out/data_info.txt", "w") as f:
    f.write(info_str)

dataset.describe().to_csv("../out/data_describe.csv")
```

输出存在缺失值的列

```python
# 选择数值列，通过select_dtypes方法选择数据类型为数值型（包括整数、浮点数等）的列
numeric_columns = dataset.select_dtypes(include=['number'])

# 检查每一个数值列中是否存在缺失值，返回一个布尔值的Series，True表示该列存在缺失值
columns_with_missing_values = dataset.isnull().any()

# 通过布尔索引筛选出存在缺失值的数值列的列名
missing_value_columns = columns_with_missing_values[columns_with_missing_values].index

print("存在缺失值的列如下：")
for col in missing_value_columns:
    print(col)
```

存在缺失值的列如下：
LotFrontage
Alley
MasVnrType
MasVnrArea
BsmtQual
BsmtCond
BsmtExposure
BsmtFinType1
BsmtFinType2
Electrical
FireplaceQu
GarageType
GarageYrBlt
GarageFinish
GarageQual
GarageCond
PoolQC
Fence
MiscFeature

其中数值列有
LotFrontage  与房产相连的街道临街面的直线长度（单位为英尺）。
MasVnrArea 以平方英尺为单位的砖石贴面面积。
# 将MasVnrArea列的缺失值填充为0
data['MasVnrArea'].fillna(0, inplace=True)
GarageYrBlt 车库建成的年份







基于房价数据的预测数据挖掘流程规划

一、数据理解与探索

数据加载与初步查看

使用合适的数据分析库（如 Pandas）将房价数据加载到数据框中，查看数据的基本信息，包括数据的行数、列数、各列的数据类型等。
检查数据是否存在缺失值、重复值以及异常值的初步迹象。

特征分类与描述性统计
将 79 个特征值按照数值类型和字符串类型进行分类。
对于数值型特征，计算其基本的描述性统计量，如均值、中位数、标准差、最小值、最大值等，以了解数据的分布情况。绘制一些关键数值特征的直方图、箱线图等可视化图表，直观地观察数据的分布形态和异常值情况。
对于字符串类型特征，统计每个类别出现的频率，了解其分布情况。例如，如果有 “房屋朝向” 这样的字符串特征，统计各个朝向（如朝南、朝北等）的房屋数量占比。

二、数据预处理
缺失值处理
识别出含有缺失值的特征列。对于数值型特征，可以考虑使用均值、中位数或其他合适的统计量进行填充；对于字符串类型特征，可以根据其出现频率最高的值进行填充，或者将缺失值作为一个特殊的类别进行处理，具体取决于数据的特点和业务理解。
异常值处理
根据数值型特征的分布情况（如通过箱线图等可视化结果），确定异常值的范围。可以采用删除异常值、将异常值修正为合理值（如根据数据的上下限进行截断）等方法进行处理。但在处理异常值时，需要结合业务知识进行判断，避免误删或错误修正重要数据。
字符串类型特征编码
对于字符串类型特征，由于大多数数据挖掘算法只能处理数值型数据，需要对其进行编码转换。常见的编码方法包括独热编码（One-Hot Encoding）和标签编码（Label Encoding）。独热编码适用于类别型特征且类别数量较少的情况，它会将每个类别转换为一个二进制向量，向量中只有一个元素为 1，表示该类别；标签编码则是将类别映射为一个整数序号，但这种方法可能会引入一些顺序关系，在某些情况下可能不合适，需要根据具体特征的性质进行选择。
特征缩放
由于不同数值型特征的取值范围可能差异很大，为了避免某些特征对模型训练产生过大的影响，需要对数值型特征进行缩放。常见的缩放方法有标准化（Standardization）和归一化（Normalization）。标准化是将特征值转换为均值为 0，标准差为 1 的分布；归一化则是将特征值映射到一个特定的区间（如 [0, 1]），具体选择哪种方法可以根据模型的要求和数据的特点来决定。
三、特征工程与选择
相关性分析
计算数值型特征之间的相关性系数（如皮尔逊相关系数），绘制相关系数矩阵的热力图，以直观地展示特征之间的线性相关关系。识别出高度相关的特征组，对于高度相关的特征，可能需要考虑只保留其中一个或进行一些特征融合操作，以减少特征冗余，避免模型过拟合。
特征重要性评估（可选）
如果数据量允许，可以使用一些特征重要性评估方法，如随机森林中的特征重要性评估。通过构建一个简单的随机森林模型，获取每个特征在模型中的重要性得分，根据得分对特征进行排序，筛选出相对重要的特征。但需要注意的是，这种方法可能会受到数据本身和模型参数的影响，结果仅供参考。
特征组合与衍生（可选）
根据对房价数据的业务理解和数据探索结果，尝试对一些特征进行组合或衍生新的特征。例如，如果有 “房屋面积” 和 “房间数量” 两个特征，可以考虑衍生出 “人均面积” 这样的新特征，看是否能提高模型的预测能力。但特征组合和衍生需要谨慎进行，避免过度增加特征维度导致模型复杂度过高。
特征选择
综合考虑相关性分析、特征重要性评估以及特征组合与衍生的结果，选择一个合适的特征子集用于后续的模型训练。可以采用逐步回归、LASSO 回归等特征选择方法，或者根据业务经验手动选择一些关键特征，以平衡模型的准确性和复杂性。
四、模型选择与训练
模型选择
根据数据的特点和问题的性质，选择适合的预测模型。常见的房价预测模型包括线性回归、决策树回归、随机森林回归、梯度提升树回归（如 XGBoost、LightGBM）等。线性回归模型简单易懂，但对于复杂的非线性关系可能拟合效果不佳；决策树回归容易理解和解释，但可能存在过拟合问题；随机森林回归和梯度提升树回归在处理复杂数据关系方面具有较好的性能，但模型相对复杂，训练时间可能较长。可以先尝试使用多种模型进行训练，然后比较它们的性能表现。
模型训练
将预处理后的数据分为训练集和测试集，通常按照 70% - 80% 的比例划分训练集，剩余部分作为测试集。使用训练集对选定的模型进行训练，调整模型的参数以优化模型的性能。对于不同的模型，参数调整的方法和重点不同。例如，对于随机森林回归，需要调整树的数量、树的深度、节点分裂的最小样本数等参数；对于梯度提升树回归，需要调整学习率、树的深度、迭代次数等参数。可以使用网格搜索（Grid Search）、随机搜索（Random Search）等方法来寻找最优的参数组合。
五、模型评估与优化
模型评估指标选择
选择合适的评估指标来衡量模型在测试集上的性能。对于房价预测问题，常用的评估指标包括均方误差（MSE）、均方根误差（RMSE）、平均绝对误差（MAE）、R 平方值（R-squared）等。均方误差是预测值与真实值之差的平方和的平均值，它对误差的大小比较敏感；均方根误差是均方误差的平方根，与原始数据的量纲相同，更直观地反映了预测误差的大小；平均绝对误差是预测值与真实值之差的绝对值的平均值，相对更稳健；R 平方值表示模型对数据的拟合程度，取值范围在 0 到 1 之间，越接近 1 表示模型拟合效果越好。
模型评估与比较
使用选定的评估指标在测试集上对训练好的模型进行评估，记录各个模型的评估结果。比较不同模型的评估指标值，选择性能最佳的模型作为最终的预测模型。如果多个模型的性能相近，可以进一步考虑模型的复杂性、训练时间、可解释性等因素进行综合选择。
模型优化
如果模型的性能不理想，可以根据评估结果和模型的特点进行优化。对于过拟合的模型，可以采用增加训练数据量、正则化（如 L1 正则化、L2 正则化）、剪枝（对于决策树模型）等方法来降低模型的复杂度；对于欠拟合的模型，可以尝试增加特征维度、调整模型参数、使用更复杂的模型结构等方法来提高模型的拟合能力。此外，还可以考虑集成学习方法，如将多个不同的模型进行集成，通过投票、平均等方式提高模型的整体性能。


MSZoning列的互异值数量为: 5
Street列的互异值数量为: 2
Alley列的互异值数量为: 3
LotShape列的互异值数量为: 4
LandContour列的互异值数量为: 4
Utilities列的互异值数量为: 2
LotConfig列的互异值数量为: 5
LandSlope列的互异值数量为: 3
Neighborhood列的互异值数量为: 25
Condition1列的互异值数量为: 9
Condition2列的互异值数量为: 8
BldgType列的互异值数量为: 5
HouseStyle列的互异值数量为: 8
RoofStyle列的互异值数量为: 6
RoofMatl列的互异值数量为: 8
Exterior1st列的互异值数量为: 15
Exterior2nd列的互异值数量为: 16
MasVnrType列的互异值数量为: 4
ExterQual列的互异值数量为: 4
ExterCond列的互异值数量为: 5
Foundation列的互异值数量为: 6
BsmtQual列的互异值数量为: 5
BsmtCond列的互异值数量为: 5
BsmtExposure列的互异值数量为: 5
BsmtFinType1列的互异值数量为: 7
BsmtFinType2列的互异值数量为: 7
Heating列的互异值数量为: 6
HeatingQC列的互异值数量为: 5
CentralAir列的互异值数量为: 2
Electrical列的互异值数量为: 5
KitchenQual列的互异值数量为: 4
Functional列的互异值数量为: 7
FireplaceQu列的互异值数量为: 6
GarageType列的互异值数量为: 7
GarageFinish列的互异值数量为: 4
GarageQual列的互异值数量为: 6
GarageCond列的互异值数量为: 6
PavedDrive列的互异值数量为: 3
PoolQC列的互异值数量为: 4
Fence列的互异值数量为: 5
MiscFeature列的互异值数量为: 5
SaleType列的互异值数量为: 9
SaleCondition列的互异值数量为: 6


对于 F - 检验（f_oneway）
在单因素方差分析中，F - 统计量（f_statistic）的值越大，越倾向于拒绝原假设。原假设是组间均值相等，也就是说，F - 统计量越大，表明不同组之间的均值差异越显著，也就意味着你所研究的因素（例如不同的房产特征）和房产价格之间的关系可能越密切。
而p - 值（p_value）则是在原假设成立的情况下，观察到当前样本数据或者更极端情况的概率。p - 值越小（通常小于设定的显著性水平，如 0.05），就越有理由拒绝原假设，即表明因素和房产价格之间有显著关系。所以从p - 值角度看，越小越能说明有关系。
对于 Kruskal - Wallis 检验（kruskal）
H - 统计量（h_statistic）的值越大，越倾向于拒绝原假设。原假设是不同组的分布相同，H - 统计量越大，表示不同组之间的分布差异越显著，也就意味着所研究的因素和房产价格之间可能存在更密切的关系。
同样，p - 值越小，越能拒绝原假设，从而说明因素和房产价格之间存在显著关系。
